# Takes the TIMIT database directory and
# introcudes blank symbol after every phone
# in the corpus. 


if [ $# -ne 1 ]; then
   echo "Argument should be the Timit directory, see ../run.sh for example."
   exit 1;
fi

. ./.path.sh

if [ ! -d $*/TRAIN ] && [ ! -d $*/train -o ]; then
	echo " introduce_blank_symbol.sh: Spot check of command line argument
	failed." 
	echo " Command line argument must be absolute pathname to TIMIT directory "
	exit 1;
fi	



# Now check what case the directory structure is
uppercased=false
train_dir=train
test_dir=test
if [ -d $*/TRAIN ]; then
  uppercased=true
  train_dir=TRAIN
  test_dir=TEST
fi

train_dir_mod=train_blank
test_dir_mod=test_blank

mkdir -p train_dir_mod test_dir_mod

for x in train; do
	# Find the list of phone files. This will have (Start Time, End Time and
	# phone occurance. Introduce the blank phone at a random time between start
	# and end of previous phone and end the blank phone at a random time
	# between start and end of next phone.
	find $*/{$train_dir} -iname '*.PHN' > $tmp_dir/${x}_phn.flist
    while read line; do
		[ -f $line ] || error_exit "Cannot find transcription file	'$line'";
	
		#	cut -f3 -d' ' "$line" | tr '\n' ' ' | sed -e 's: *$:\n:'
	#done < $tmpdir/${x}_phn.flist > $tmp_dir/${x}_phn.trans

    	# Blank symbol begins at a random time stamp between start and end of phone. 
	    cat "$line" | awk '{ print $1, int($1 + ($2-$1)*rand()), $2, $3 }' | awk '{ print $1, $2, $2,
		$3, $4 }' | awk '{ print $1,$2,$5}{ print $3,$4,"BL"}' <
		$tmp_dir/${x}_phn.flist > $*/{train_blank}


